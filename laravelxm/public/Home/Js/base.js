function gid(t){return document.getElementById(t)}ec.account.isLogin=function(){return ec.account.id&&ec.account.loginName},function(){var t=function(){setTimeout(function(){if(ec.account.isLogin()){var t=ec.util.escapeHtml(ec.account.nickName)||ec.util.escapeHtml(ec.account.name)||ec.account.loginName;$("#customer_name").html(t),$("#cart_unlogin_info")[0]&&$("#cart_unlogin_info p").html('<a href="/member?t='+(new Date).getTime()+'">'+t+"</a>"),$("#login_status,#cart_login_info").show(),$("#unlogin_status,#cust_login_info").hide(),ec.account.showVipInfo();var e=ec.util.cookie.get("caibeiShowMsg"),n=ec.util.cookie.get("caibeiHeadShow"),a=ec.util.cookie.get("caibeiJifenUrl");void 0!=e&&null!=e&&e.length>0&&($("#HeadShow").html(n),void 0!=a&&null!=a&&a.length>0&&(e=e+"<b>|</b><a href='"+a+"' title='我的彩贝积分' target='_blank'>我的彩贝积分</a>"),$("#ShowMsg").html(e),$("#caibeiMsg").show())}},200)},e=function(e){var n="callback"+(new Date).getTime(),a="/account/login?type=frame&url="+encodeURIComponent("/account/upCallback.html?"+n),c="up-iframe-"+(new Date).getTime(),o='<iframe class="boxIframe" width="100%" height="100%" frameborder="0" name="'+c+'" src="about:blank" scrolling="no"></iframe><script>setTimeout(function(){window["'+c+'"].location.href="'+a+'";} ,100);</script>',i=new ec.box(o,{boxid:"ec_login",title:" ",remember:!1,width:500,height:470,showButton:!1,onclose:function(t){try{delete window[n]}catch(e){window[n]=null}t.find("iframe").each(function(){this.contentWindow.close(),jQuery(this).remove()})}}).open();window[n]=function(){ec.load({url:domainMain+"/account/status?"+(new Date).getTime(),type:"js",onload:t}),e(),i.close()}};ec.account.afterLogin=function(t){ec.account.isLogin()?t():e(t)},ec.load({url:domainMain+"/account/status?"+(new Date).getTime(),type:"js",loadType:"lazy",onload:t}),ec.ready(function(){ec.base.getTotal()})}(),ec.account.showVipInfo=function(){if(ec.account.userState&&"1"==ec.account.userState){$("#vip-inActive").hide(),$("#vip-Active i").removeClass().addClass("icon-vip-level-"+ec.account.custGrade),$("#vip-Active").attr("title","VMALL V"+ec.account.custGrade+"会员"),$("#vip-Active").show();var t=[];t.push('<em class="vip-state" id="vip-info">&nbsp;&nbsp;&nbsp;&nbsp;'),t.push('<a href="/member/point" title="VMALL V'+ec.account.custGrade+'会员" id="vip-Active" ><i class="icon-vip-level-'+ec.account.custGrade+'"></i></a>'),t.push("</em>"),$("#cart_unlogin_info p").append(t.join(""))}else $("#cart_unlogin_info p").append('&nbsp;&nbsp;<em class="vip-state"><a class="link-noAct" href="/member/account" id="vip-inActive" title="请完善个人信息，即刻享受会员特权">去激活</a></em>'),$("#vip-inActive").show(),$("#vip-Active").hide()},ec.pkg("ec.minicart"),ec.minicart.del=function(t,e,n){var a={sbs:e.toString(),types:n.toString()};ec.cart.del(a,function(){$(t).parents("li").remove()})},ec.pkg("ec.product"),ec.product.history={load:function(t,e,n){$.ajax({url:"/product/browsed/query.json",data:{size:e?e:void 0,pid:n?n:void 0},dataType:"json",success:function(e){e.success&&t(e.list||[])}})},add:function(t){var e=new Image;e.src="/product/browsed/add?id="+t+"&_t="+(new Date).getTime(),e=null},clear:function(t){var e=new Image;e.src="/product/browsed/clear?_t="+(new Date).getTime(),e=null,t&&t()}},ec.product.inventory={_data:{},set:function(t,e){this._data[t]=e},haveInventory:function(t){return this._data[t]}},ec.pkg("ec.cart"),ec.cart.add=function(t,e){1==t.type?ec.code.addAnalytics({hicloud:!1,operate:!0,optype:1,skuIds:t.skuIds,bundleIds:[],custBundleIds:[],custSkuIds:[]}):2==t.type&&ec.code.addAnalytics({hicloud:!1,operate:!0,optype:1,skuIds:[],bundleIds:t.skuIds,custBundleIds:[],custSkuIds:[]});var n={};n.sbs=t.skuIds.join(","),n.type=t.type.join(","),n.qty=t.quantity.join(","),t.extendSkuIds&&t.extendSkuIds.length>0&&(n.ess=t.extendSkuIds.join(",")),$.ajax({url:domainMain+"/order/shoppingCart/addcart.json",dataType:"jsonp",timeout:3e4,traditional:!0,data:n,success:function(a){if(!a.success)return void(e.errorFunction&&e.errorFunction(a));if(e.successFunction){n.qty=t.quantity.join(",");var c=new Date;n.t=c.getTime(),$.ajax({url:domainCart+"/cart/add.json",dataType:"jsonp",timeout:3e4,traditional:!0,data:n,success:function(t){return t.success?void(e.successFunction&&e.successFunction(t)):void(e.errorFunction&&e.errorFunction(t))},error:function(t,n){if(e.errorFunction){var a={};a.msg=n,e.errorFunction(a)}}})}},error:function(t,n){if(e.errorFunction){var a={};a.msg=n,e.errorFunction(a)}}})},ec.cart.getCartItemsInternal=function(t,e){$.ajax({url:domainCart+"/cart/shoppingCart.json?t="+(new Date).getTime(),dataType:"jsonp",timeout:1e4,success:function(n){n.cart&&n.cart.length>0?t(n.cart,e):t(null,e)}})},ec.cart.getCartItems=function(t,e){var n=ec.util.cookie.get("cartId");n&&n.length>0?$.ajax({url:domainCart+"/cart/cache2cart.json?t="+(new Date).getTime(),dataType:"jsonp",timeout:1e4,cache:!1,success:function(){ec.cart.getCartItemsInternal(t,e)}}):ec.cart.getCartItemsInternal(t,e)},ec.cart.buildQueryData=function(t){for(var e=[],n=[],a=[],c=[],o=0;o<t.length;o++){var i=t[o];if(i.skuId)e.push(i.skuId);else{if(!i.bundleId)continue;e.push(i.bundleId)}n.push(i.productType),a.push(i.quantity),c.push(i.mainSkuId?i.mainSkuId:"")}var r=new Date;return{sbs:e.join(","),types:n.join(","),qtys:a.join(","),ess:c.join(","),t:r.getTime()}},ec.cart.getOnceCartInfo=function(t,e,n){var a=ec.cart.buildQueryData(t);$.ajax({url:domainMain+"/order/shoppingCart/cart.json",dataType:"jsonp",timeout:1e4,traditional:!0,data:a,success:function(t){if(null!=n)e(t,n);else{if(!t.success||!t.cartInfo)return;e(t)}},error:function(){if(null!=n){var t={};t.success=!1,e(t,n)}}})},ec.cart.batchCount=50,ec.cart.getCartInfo=function(t,e){if(!t||0==t.length)return void e({});if(t.length<=ec.cart.batchCount)ec.cart.getOnceCartInfo(t,e);else{var n=[],a=[],c=[];t:for(var o=0;o<t.length;o++){var i=t[o];if(1==i.productType)c.push(i),c.length==ec.cart.batchCount&&(n.push(c),c=[]);else if(6==i.productType){for(var r=0;r<n.length;r++){var s=n[r];if(1==s[0].productType)for(var u=0;u<s.length;u++)if(s[u].skuId==i.mainSkuId){s.push(i);continue t}}for(var r=0;r<c.length;r++)c[r].skuId==i.mainSkuId&&c.push(i)}else a.push(i),a.length==ec.cart.batchCount&&(n.push(a),a=[])}a.length>0?a.length+c.length<=ec.cart.batchCount?(a.push(c),n.push(a)):(n.push(a),n.push(c)):c.length>0&&n.push(c);var l={};l.cartInfo={},l.cartInfo.bundlerList=[],l.cartInfo.productList=[],l.cartInfo.couponList=[],l.cartInfo.premiumsList=[],l.cartInfo.totalOriginalPrice=0,l.cartInfo.totalPrice=0,l.limitstock=[],l.understock=[];for(var d=0,o=0;o<n.length;o++){var s=n[o];ec.cart.getOnceCartInfo(s,function(t){d+=1,t.success&&t.cartInfo&&(t.cartInfo.bundlerList&&t.cartInfo.bundlerList.length>0&&(l.cartInfo.bundlerList=l.cartInfo.bundlerList.concat(t.cartInfo.bundlerList)),t.cartInfo.productList&&t.cartInfo.productList.length>0&&(l.cartInfo.productList=l.cartInfo.productList.concat(t.cartInfo.productList)),t.cartInfo.couponList&&t.cartInfo.couponList.length>0&&(l.cartInfo.couponList=l.cartInfo.couponList.concat(t.cartInfo.couponList)),t.cartInfo.premiumsList&&t.cartInfo.premiumsList.length>0&&(l.cartInfo.premiumsList=l.cartInfo.premiumsList.concat(t.cartInfo.premiumsList)),l.cartInfo.totalOriginalPrice+=t.cartInfo.totalOriginalPrice,l.cartInfo.totalPrice+=t.cartInfo.totalPrice,t.limitstock&&t.limitstock.length>0&&(l.limitstock=l.limitstock.concat(t.limitstock)),t.understock&&t.understock.length>0&&(l.understock=l.understock.concat(t.understock))),d==n.length&&e(l)},o)}}},ec.cart.getCart=function(t){ec.cart.getCartItems(ec.cart.getCartInfo,t)},ec.cart.getCartBaseInfo=function(t,e){if(t&&t.length>0){var n=ec.cart.buildQueryData(t);$.ajax({url:"/page/baseInfo.json",type:"POST",dataType:"json",data:n,success:function(t){e(t)}})}else e({cartInfo:{totalNumber:0,totalPrice:0}})},ec.cart.getCartBase=function(t){ec.cart.getCartItems(ec.cart.getCartBaseInfo,t)},ec.cart.getTotal=function(){ec.cart.getCartBase(function(t){var e=t.cartInfo,n=t.shopInfo,a=$("#minicart-pro-empty"),c=$("#minicart-pro-list-block"),o=$("#minicart-pro-settleup");ec.minicart.microCartTpl&&($("#header-cart-total,#micro-cart-total").html(e.totalNumber||0),e.totalNumber>0?($("#micro-cart-totalPrice").html("&yen;&nbsp;"+parseFloat(e.totalPrice).toFixed(2)),$("#minicart-pro-list").html(ec.minicart.microCartTpl.parse("microCartList",e)),c.show(),o.show(),a.hide(),e.productList.length+e.bundlerList.length>5?c.addClass("minicart-pro-list-scroll"):c.removeClass("minicart-pro-list-scroll")):(a.show(),c.hide(),o.hide()),n&&($("#toolbar-orderWaitingHandleCount").html(n.orderWaitingHandleCount).attr("class",n.orderWaitingHandleCount<=0?"grey":""),$("#toolbar-couponCount").html(n.couponCount).attr("class",n.couponCount<=0?"grey":""),$("#toolbar-newMsgCount").html(n.newMsgCount).attr("class",n.newMsgCount<=0?"grey":""))),t.enterpriseUser&&($("#preferential").html('<b>|</b><a class="red" href="/member/enterprise" title="优惠内购" rel="nofollow">优惠内购</a>'),$("#li-enterprise").html('<a href="/member/enterprise" title="优惠内购"><span>优惠内购</span></a>').show())})},ec.cart.del=function(t,e){for(var n=t.types.split(","),a=[],c=[],o=t.sbs.split(","),i=o.length,r=0;i>r;r++)1==n[r]?a.push(o[r]):2==n[r]&&c.push(o[r]);ec.code.addAnalytics({hicloud:!1,operate:!0,optype:0,skuIds:a,bundleIds:c,custBundleIds:[],custSkuIds:[]}),ec.ui.loading.show({modal:!1});var s=new Date;t.t=s.getTime();var u={data:t,dataType:"jsonp",timeout:1e4,timeoutFunction:function(){ec.ui.loading.hide(),alert("操作超时，请重试！")},successFunction:function(t){return t.success?(e&&e(t),void ec.ui.loading.hide()):(ec.ui.loading.hide(),void ec.showError(t))}};u.url=domainCart+"/cart/del.json",(new ec.ajax).get(u)},ec.cart.setRecover=function(t){ec.util.cookie.set("cart-recover",t,{domain:".vmall.com",path:"/"})},ec.cart.removeSkuFromRecover=function(t,e){var n=ec.util.cookie.get("cart-recover");if(n){var a=new RegExp(","+t+";\\d+,");n=n.replace(a,","),ec.cart.setRecover(n)}e&&e(n)},ec.cart.jumpToConfirm=function(t,e){var n=[],a=[],c=[],o=[];t.each(function(){var t=$(this).closest("tbody"),e=this.value,i=$("#quantity-"+e,t).val();if(i){n.push(e),a.push(1),c.push(i),o.push("");var r=$('input[name="extendIds"]',t).val();r&&(n.push(r),a.push(6),c.push(i),o.push(e));var s=$('input[name="accidentIds"]',t).val();s&&(n.push(s),a.push(7),c.push(i),o.push(e))}}),e.each(function(){var t=$(this).closest("tbody"),e=this.value,i=$("#quantity-"+e,t).val();i&&(n.push(e),a.push(2),c.push(i),o.push(""))}),setTimeout(function(){ec.cart.confirm(1,n.join(","),a.join(","),c.join(","),o.join(","))},500)},ec.cart.confirm=function(t,e,n,a,c,o,i){var r=$('<form action="'+domainMain+'/order/confirmcart" method="post"></form>');r.append('<input name="sbs" type="hidden" value="'+e+'" />'),r.append('<input name="types" type="hidden" value="'+n+'" />'),r.append('<input name="qtys" type="hidden" value="'+a+'" />'),r.append('<input name="ess" type="hidden" value="'+c+'" />'),t&&r.append('<input name="state" type="hidden" value="'+t+'" />'),o&&r.append('<input name="orderTag" type="hidden" value="'+o+'" />'),i&&r.append('<input name="groupRecordId" type="hidden" value="'+i+'" />'),$("body").append(r),r.submit()},ec.pkg("ec.base"),ec.base.getTotal=function(){$.ajax({url:domainMain+"/page/totalInfo.json",dataType:"jsonp",success:function(t){t.enterpriseUser&&($("#preferential").html('<b>|</b><a class="red" href="/member/enterprise" title="优惠内购" rel="nofollow">优惠内购</a>'),$("#li-enterprise").html('<a href="/member/enterprise" title="优惠内购"><span>优惠内购</span></a>').show())}})},function(){var t;ec.ready(function(){$("#ec_ui_confirm_no").unbind("click").click(function(){$("#ec_ui_confirm").hide()}),$("#ec_ui_tips_yes").unbind("click").click(function(){$("#ec_ui_tips").hide()})}),ec.ui.confirm=function(e,n){var a=ec.ui.confirm.caller,c=a.arguments;if(null!=t&&c[c.length-1]==t)return t=null,!0;$("#ec_ui_confirm_msg").html(n);for(var o=$(e),i=$("#ec_ui_confirm"),r=o.offset(),s=r.top-i.outerHeight(!0)-5,u=r.left-i.outerWidth(!0)/2,l=[],d=c.length,m=c.callee.length,p=0;d>p;p++)l.push(c[p]);return l[m]=t=(new Date).getTime(),$("#ec_ui_confirm_yes").unbind("click").click(function(){$("#ec_ui_confirm").hide(),a.apply(this,l),l=null}),i.css({top:s,left:u,position:"absolute"}).show(),!1},ec.ui.tips=function(t,e){$("#ec_ui_tips_msg").html(e);var n=$(t),a=$("#ec_ui_tips"),c=n.offset(),o=c.top-a.outerHeight(!0)-5,i=c.left-a.outerWidth(!0)/2;a.css({top:o,left:i,position:"absolute"}).show()}}(),$.extend(ec.form.validator.defaults,{errorClass:"error",autoFocus:!1,errorFunction:function(t,e){var n="icon-error",a=e.msg[e.type]||e.msg["default"];switch(a=a.length<=0?"&nbsp;":a,e.type){case"require":n="icon-warn"}if(e.msg_ct)$(e.msg_ct).html("<span class='vam "+n+"'>"+a+"</span>");else{var c=(t.attr("id")||t.attr("name"))+"-msg";$("#"+c).remove(),t.after("<span id='"+c+"' class='vam "+n+"'>"+a+"</span>")}e.autoFocus&&t.focus()},successFunction:function(t,e){e.msg_ct?$(e.msg_ct).html(""):$("#"+(t.attr("id")||t.attr("name"))+"-msg").remove()}}),ec.form.validator.register("mobile",function(t,e){return e.allowEmpty&&ec.util.isEmpty(t)?!0:t.length<11?!1:/^(\+|00)?((86)?(1[3458])[0-9]{9}|852[9865][0-9]{7})$/.test(t)}),ec.form.validator.register("phone",function(t,e){return e.allowEmpty&&ec.util.isEmpty(t)?!0:t.length<7?!1:/^((0[0-9]{2,3}\-)?[2-9][0-9]{6,7}|((00852|\+852)\-)?([2-3][0-9]{7}))+(\-[0-9]{1,4})?$/.test(t)}),ec.ui.number=function(t,e){var n={max:null,min:null,showButton:!0,minusBtn:'<a title="减" class="icon-minus vam" href="javascript:;"><span>-</span></a>',plusBtn:'<a title="加" class="icon-plus vam" href="javascript:;"><span>+</span></a>'},a=$(t),e=$.extend(n,e),c=function(t){var n=t.which,a=parseInt(this.value,10),c=1>a?1:a;if((37>n||n>40)&&8!=n&&46!=n){if(c>e.max||c<e.min)return t.preventDefault(),!1;if((48>n||n>57)&&(96>n||n>105)&&9!=n)return t.preventDefault(),!1}};a.each(function(){var t=$.extend({},e),n=$(this).css("ime-mode","disabled"),a=n.attr("max");if(a&&(e.max=t.max=parseInt(a,10)||t.max),a=n.attr("min"),a&&(e.min=t.min=parseInt(a,10)||t.min),t.showButton){var o=$(t.minusBtn).click(function(){var e=n.val()||0,a=parseInt(e,10)-1;"number"==typeof t.min&&a<t.min||n.val(a).trigger("blur")}),i=$(t.plusBtn).click(function(){var e=n.val()||0,a=parseInt(e,10)+1;"number"==typeof t.max&&a>t.max||n.val(a).trigger("blur")});n.after(i).before(o)}n.data("ovalue",n.val()||0).keydown(c).keyup(function(){var e=parseInt(this.value||0);return"number"==typeof t.min&&e<t.min?void(this.value=t.min):"number"==typeof t.max&&e>t.max?void(this.value=t.max):void 0}).blur(function(){if("function"==typeof t.onchange){var e=n.data("ovalue"),a=this.value||0,c=parseInt(a,10)-parseInt(e,10);if(0==c)return;t.onchange.call(this,a,c),n.data("ovalue",a)}})})},ec.ui.countdown=function(t,e){var n,a,c=$(t),o=c.data("countdown"),i=0,r=e.now.getTime()-(new Date).getTime(),s=0,u=function(){return i>=e.times.length?!1:(n=e.times[i],i++,!0)},l=function(){return s=Math.round((n.parseDate("yyyy-MM-dd HH:mm:ss").getTime()-(new Date).getTime()-r)/1e3),s=0>=s?0:s},d=function(){s--,0>=s&&(s=0),a={day:Math.floor(s/86400),hour:e.html.indexOf("{#day}")>=0?Math.floor(s/60/60)%24:Math.floor(s/60/60),minute:Math.floor(s/60)%60,second:s%60};var t=e.html.replace(/{#day}/g,a.day).replace(/{#hours}/g,a.hour>9?a.hour:"0"+a.hour).replace(/{#minutes}/g,a.minute>9?a.minute:"0"+a.minute).replace(/{#seconds}/g,a.second>9?a.second:"0"+a.second);return c.html(t),0>=s?!1:!0};for(e.times||(e.times=[e.endTime]),clearInterval(o);u()&&l()<=0;);d()&&(o=setInterval(function(){d()||(e.callback&&e.callback(e),u()?l():clearInterval(o))},1e3),c.data("countdown",o))},function(){var t,e,n=$(window),a=!1,c="CSS1Compat"==document.compatMode?document.documentElement:document.body,o=0,i=0,r=[],s=function(t){var e=t.offset().top,n=e+t.height();return e>=o&&i>=e||n>=o&&i>=n?(t.attr("src",t.attr("data-lazy-src")),t.removeAttr("data-lazy-src"),!0):!1};_bindEvent=function(){var a=function(){clearTimeout(e),e=setTimeout(function(){o=n.scrollTop(),i=o+t;for(var e,c=0;c<r.length;c++)e=r[c],s(e)&&(r.splice(c,1),c--);r&&0!=r.length||(n.unbind("scroll",a),n.unbind("resize",u))},100)},u=function(){t=c.clientHeight};n.bind("scroll",a),n.bind("resize",u),t=c.clientHeight,o=n.scrollTop(),i=o+t},ec.ui.lazyLoad=function(t){a||(_bindEvent(),a=!0),$(t).each(function(){if("IMG"==this.tagName){var t=$(this);t.attr("data-lazy-src")&&(s(t)||(t.attr("src",ol.libPath+"../../images/echannel/loading/mask.png"),r.push(t)))}})}}(),ec.ready(function(){ec.ui.lazyLoad($("body").children(".layout,.g").find("img")),ec.ui.hrefSetTime()}),ec.showError=function(t){return"login"==t.code?(alert("登录超时，请重新登录"),location.reload(),!1):void alert(t.msg)},ec.load("ajax",{loadType:"lazy"}),function(){var t=function(){var t=ec.form.validator.bind,e=$("#surveryContent"),n=$("#surveryContact"),a=$("#surveryVerify");t(e,{type:["require","length"],validOnChange:!0,msg_ct:"#errMsg",max:200,min:5,msg:{require:"您还没有输入反馈信息哦",length:"反馈信息内容请控制在5~200个字符之间"}}),t(n,{type:["length"],validOnChange:!0,msg_ct:"#errMsg",min:2,max:100,msg:{length:"请输入正确的联系方式"}}),t(a,{type:["require"],validOnChange:!0,msg_ct:"#errMsg",msg:{require:"请输入验证码"}}),ec.account.isLogin()&&n.val(ec.util.escapeHtml(ec.account.email)||ec.util.escapeHtml(ec.account.mobile)||ec.account.loginName),ec.form.input.label(n,"选填，邮箱或者商城账户"),ec.form.input.label(e,"谢谢您的宝贵建议，我们将不断改进")};ec.survery={open:function(){t&&(t(),t=null),ol.ui.masker.mask({css:{opacity:.4}}),ec.survery.reloadCode(),$("#survery-box").show()},close:function(){ol.ui.masker.unmask(),$("#survery-box").hide()},submit:function(t){if(!ec.form.validator(t,!0))return!1;this.box;return(new ec.ajax).submit({form:t,url:"/feedback.json",timeout:1e4,timeoutFunction:function(){alert("保存超时，请重试！")},successFunction:function(t){return t.success?(alert("提交成功，华为商城感谢您的宝贵建议！"),ec.survery.close(),void $("#surveryContent,#surveryVerify").val("")):void $("#errMsg").html('<span class="error">提交失败，'+t.msg+"</span>")}}),!1},reloadCode:function(){gid("surveryVerifyImg").src="/feedback/randomCode?_t="+(new Date).getTime()}}}(),$(function(){var t,e=$(window),n=$("#hungBar-top"),a=function(){n.stop(),e.scrollTop()>50?n.animate({opacity:1},"slow"):n.animate({opacity:0},"slow"),t=null};e.scroll(function(){t=setTimeout(a,50)}),a()}),function(){ec.ui.hrefSetTime=function(){var t=(new Date).getTime();try{$("a[timeType=timestamp]").each(function(){var e=$(this);e.attr("href",e.attr("href").replace(/timestamp/g,t))})}catch(e){console.log(e)}}}();