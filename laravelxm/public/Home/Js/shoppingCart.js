ec.pkg("ec.shoppingCart"),ec.load("ajax",{loadType:"lazy"}),ec.shoppingCart.check=function(t){var e=$("#order-pro-"+t.value);t.checked?e.addClass("selected"):(e.removeClass("selected"),$("#checkAll-buttom,#checkAll-top").attr("checked",!1))},ec.shoppingCart.checkAll=function(t){$(t).attr("checked")?($("#cart-list input[type=checkbox]").attr("checked",!0),$("#cart-list").children(".order-pro-area").addClass("selected")):($("#cart-list input[type=checkbox]").attr("checked",!1),$("#cart-list").children(".order-pro-area").removeClass("selected"))},ec.shoppingCart.confirm=function(){_paq.push(["trackLink","购物车-去结算","link"," "]),ec.code.addAnalytics({hicloud:!0});var t=$("#cart-list input[name='skuIds']:checked"),e=$("#cart-list input[name='bundleIds']:checked");return 0==t.length&&0==e.length?void alert("请至少选中一个商品！"):ec.shoppingCart._checkUnderstockAndLimitstock()?void ec.cart.jumpToConfirm(t,e):!1},ec.shoppingCart._renderNum=function(){ec.ui.number("#cart-list .shop-quantity",{max:999,min:1,minusBtn:'<a href="javascript:;" class="icon-minus-3 vam" title="减"><span>-</span></a>',plusBtn:'<a href="javascript:;" class="icon-plus-3 vam" title="加"><span>+</span></a>',onchange:function(t,e){var a=$(this),r=a.attr("data-skuId"),c=a.attr("data-type");ec.shoppingCart._updateNum(r,c,e)}})},ec.shoppingCart._checkUnderstockAndLimitstock=function(){var t=!0,e=function(t){return $(t).closest("table").find("input[type=checkbox]")};if($(".understock").length>0||$(".limitstock").length>0){var a=$(".limitstock"),r=$(".understock");a.length>0&&a.each(function(a,r){return e(r).attr("checked")?(t=!1,$("#tips-text-p").html("购物车商品达到购买上限，请处理后结算"),!1):void 0}),r.length>0&&r.each(function(a,r){return e(r).attr("checked")?(t=!1,$("#tips-text-p").html("购物车有库存不足商品，请处理后结算"),!1):void 0})}return t?$("#sc-action-tips").addClass("hide"):$("#sc-action-tips").removeClass("hide"),t},ec.shoppingCart._updateNum=function(t,e,a){var r=[];$("#cart-list input:checked").each(function(){r.push(this.value)}),ec.ui.loading.show();var c={data:{types:e,sbs:t,qty:a,t:(new Date).getTime()},timeout:1e4,timeoutFunction:function(){ec.ui.loading.hide(),alert("操作超时，请重试！")},successFunction:function(t){return t.success?(ec.cart.refreshCartTable(t.cart,!0),void ec.ui.loading.hide()):(ec.ui.loading.hide(),void ec.showError(t))}};c.url="/cart/updateNum.json",(new ec.ajax).submit(c)},ec.shoppingCart._renderInventory=function(t,e){var a=function(t,e,a){t&&t.length>0&&$(e+t.join(","+e),"#cart-form").html(a).show()};a(t,".understock-",'<s class="understock"></s>'),a(e,".limitstock-",'<div class="p-tips limitstock"><div class="tips-style-1 tips-area"><i></i><div class="tips-text"><p>达到购买上限</p></div></div></div>'),a(e,".normalLimitstock-",'<div class="sc-stock-tips limitstock"><div class="tips-style-1 tips-area"><i></i>	<div class="tips-text"><p>达到购买上限</p></div>	<s></s></div></div>')},ec.shoppingCart._renderColorAndVersion=function(){$(".p-spite-sku").each(function(){var t=$(this),e=t.html(),a=t.parent();t.remove();for(var r=e.split("~"),c="",i="",s=0,n=r.length;n>s;s++){var d=$.trim(r[s]);d.startWith("颜色")?c=d:d.startWith("版本")&&(i=d)}var o="";i&&(o="<em>"+i+"</em>"),c&&(o=o+"<em>"+c+"</em>"),a.html(o)})},ec.shoppingCart.del=function(t,e,a,r){if(!e&&0==$("#cart-list input[name='skuIds']:checked").length&&0==$("#cart-list input[name='bundleIds']:checked").length)return void alert("请选择您要删除的商品！");if(ec.ui.confirm(t,e?"您确认要删除该商品吗？":"您确认要删除这些商品吗？")){var c={};if(e)c.sbs=e.toString(),c.types=a,c.types=void 0===c.types?"1":a.toString(),r&&(c.ess=r);else{var i=[],s=[];$("#cart-list input[name='skuIds']:checked").each(function(){i.push(this.value),s.push(1)}),$("#cart-list input[name='bundleIds']:checked").each(function(){i.push(this.value),s.push(2)}),c.sbs=i.join(","),c.types=s.join(",")}ec.cart.del(c,function(t){var a=ec.util.cookie.get("cart-recover")||",",r=function(t,e){var r=a.indexOf(","+t+";");if(-1==r)a+=t+";"+e+",";else{var c=a.substring(r+t.toString().length+2,a.indexOf(",",r+1));e+=parseInt(c),a=a.replace(","+t+";"+c+",",","+t+";"+e+",")}},c=function(t){var e=parseInt($("#quantity-"+t).val(),10);$("#order-pro-"+t+" input[name=skuIds]").each(function(){r(this.value,e)})};e?c(e):$("input[name=bundleIds]:checked,input[name=skuIds]:checked","#cart-form").each(function(){c(this.value)}),ec.cart.setRecover(a),ec.cart.refreshCartTable(t.cart),ec.cart.refreshRecover()})}},ec.cart.readd=function(t,e){var a=function(){ec.cart.removeSkuFromRecover(t,function(t){(!t||t.length<3)&&$("#pro-recover-area").hide()})};if($("#box-"+t).length>0)ec.shoppingCart._updateNum(t,1,e),a(),ec.cart.refreshRecover(),$("#pro-recommend-area").empty(),ec.cart.initRecommend();else{var r={skuIds:[t],quantity:[e],type:[1]};ec.cart.add(r,{successFunction:function(t){a(),ec.cart.refreshCartTable(t.cart),ec.cart.refreshRecover()},errorFunction:function(t){alert(t.msg)}})}},ec.cart.slider={size:0,index:0,prev:function(){this.index<=0||this.size<6||(this.index--,$("#pro-recommend-list").animate({left:-193*this.index},1e3),$("#cart-img-next").attr("class","pro-scroller-forward"),0==this.index&&$("#cart-img-prev").attr("class","pro-scroller-back-disabled"))},next:function(){this.index+5>=this.size||this.size<6||(this.index++,$("#pro-recommend-list").animate({left:-193*this.index},1e3),$("#cart-img-prev").attr("class","pro-scroller-back"),this.index+5==this.size&&$("#cart-img-next").attr("class","pro-scroller-forward-disabled"))}},ec.cart.refreshRecover=function(){$("#pro-recover-area").hide();var t=ec.util.cookie.get("cart-recover");if(t){t=t.split(",");for(var e,a={},r=[],c=1;c<t.length-1;c++)e=t[c].split(";"),r.push(e[0]),a[e[0]]=e[1];r.length>0&&$.ajax({url:domainMain+"/product/queryInfo.json?skuId="+r.join("&skuId=")+"&t="+(new Date).getTime(),dataType:"jsonp",timeout:1e4,success:function(t){if(t.success){for(var e,r,c=[],i=[],s=ec.util.cookie.get("cart-foldingDoor"),n=0;n<t.data.length;n++)e=t.data[n],r=parseInt(a[e.skuId],10),0==n&&(i.push('<tr id="pro-recover-'+e.skuId+'"><td class="tr-pro"><a href="'+domainMain+"/product/"+e.prdId+".html#"+e.skuId+'" target="_blank" title="'+e.name+'">'+e.name+"</a></td>"),i.push('<td class="tr-quantity">'+r+"</td>"),i.push('<td class="tr-subtotal">&yen;'+r*e.price+"</td>"),i.push('<td class="tr-operate"><a class="button-style-4 button-re-purchase" title="重新购买" href="javascript:;" onclick="ec.cart.readd('+e.skuId+" , "+r+');return false;">重新购买</a></td></tr>')),c.push('<tr id="pro-recover-'+e.skuId+'"><td class="tr-pro"><a href="'+domainMain+"/product/"+e.prdId+".html#"+e.skuId+'" target="_blank" title="'+e.name+'">'+e.name+"</a></td>"),c.push('<td class="tr-quantity">'+r+"</td>"),c.push('<td class="tr-subtotal">&yen;'+r*e.price+"</td>"),c.push('<td class="tr-operate"><a class="button-style-4 button-re-purchase" title="重新购买" href="javascript:;" onclick="ec.cart.readd('+e.skuId+" , "+r+');return false;">重新购买</a></td></tr>');1==t.data.length?($("#pro-delete-shop-start").hide(),$("#pro-delete-shop-end").hide(),$("#pro-recover-tb").html(i.join(""))):(s&&"doorClose"!=s?"doorOpen"==s&&($("#pro-delete-shop-start").hide(),$("#pro-delete-shop-end").show(),$("#pro-recover-tb").html(c.join(""))):($("#pro-delete-shop-start").show(),$("#pro-delete-shop-end").hide(),$("#pro-recover-tb").html(i.join(""))),$("#pro-delete-shop-start").unbind("click").bind("click",function(){ec.util.cookie.set("cart-foldingDoor","doorOpen"),$("#pro-delete-shop-start").hide(),$("#pro-delete-shop-end").show(),$("#pro-recover-tb").html(c.join(""))}),$("#pro-delete-shop-end").unbind("click").bind("click",function(){ec.util.cookie.set("cart-foldingDoor","doorClose"),$("#pro-delete-shop-start").show(),$("#pro-delete-shop-end").hide(),$("#pro-recover-tb").html(i.join(""))})),$("#pro-recover-area").show()}}})}},ec.cart.initRecommend=function(){var t=[];$("input[name=skuIds]","#cart-form").each(function(){t.push(this.value)}),t.length>0&&$.ajax({url:domainMain+"/product/recommend.json?skuIds="+t.join("&skuIds=")+"&t="+(new Date).getTime(),dataType:"jsonp",timeout:1e4,success:function(t){if(t.success&&t.data&&0!=t.data.length){var e=t.data.length;ec.cart.slider.size=e;for(var a,r=[],c=0;e>c;c++)a=t.data[c],r.push("<li><div>"),r.push('<p class="p-img"><a title="'+a.name+'"  target="_blank" href="'+domainMain+"/product/"+a.prdId+".html#"+a.skuId+'"><img alt="'+a.name+'" src="'+ec.mediaPath+a.photoPath+"142_142_"+a.photoName+'"></a></p>'),r.push('<p class="p-name"><a title="'+a.name+'" target="_blank" href="'+domainMain+"/product/"+a.prdId+".html#"+a.skuId+'">'+a.name+"</a></p>"),r.push('<p class="p-price"><b>¥'+a.price+"</b></p>"),r.push('<p class="p-button"><a class="button-style-4 button-add-cart-3" href="javascript:;" title="加入购物车" onclick="ec.cart.readd('+a.skuId+' , 1);return false;">加入购物车</a></p>'),r.push("</div></li>");$("#pro-recommend-area").show(),e>5&&$("#cart-img-next").attr("class","pro-scroller-forward"),$("#pro-recommend-list").width(193*e).html(r.join(""))}}})},ec.cart.buildItemTable=function(t,e){var a=$("<tbody></tbody>");return e.append(a),a.wrap('<div class="sc-pro-area selected" id="order-pro-'+t+'"><table border="0" cellpadding="0" cellspacing="0"></table></div>'),a},ec.cart.buildCheckbox=function(t,e){var a=$('<td rowspan="'+e+'" class="tr-check"><input id="box-'+t+'" class="checkbox" type="checkbox" name="bundleIds" value="'+t+'" checked/></td>');return a},ec.cart.escape=function(t){var e=t.replace(/&/g,"&amp");return e=e.replace(/\</g,"&lt"),e=e.replace(/\>/g,"&gt")},ec.cart.buildSkuSummary=function(t,e,a){var r,c="";switch(t.productType){case 1:r="";break;case 2:c=' id="skuId-'+t.skuId+'"',r="<b>[套餐]</b>";break;case 3:r="<b>[赠品]</b>";break;case 4:r="<b>[延保]</b>";break;default:return $("<td></td>")}var i="";t.skuAttrValues&&(i='<p class="p-sku"><em class="p-spite-sku">'+t.skuAttrValues+"</em></p>");var s="";t.shopName&&1!=t.shopId&&(s='<p class="p-explain">此商品由'+t.shopName+"发货</p>");var n=ec.cart.escape(t.prdSkuName),d=$('<td class="tr-pro"><div class="pro-area clearfix"'+c+'><p class="p-img"><a title="'+n+'" target="_blank" href="'+e+"/product/"+t.id+".html#"+t.skuId+' seed="cart-item-name"><img alt="'+n+'" src="'+a+t.photoPath+"78_78_"+t.photoName+'"/></a></p><p class="p-name">'+r+'<a title="'+n+'" target="_blank" href="'+e+"/product/"+t.id+".html#"+t.skuId+'" seed="cart-item-name">'+n+"</a></p>"+i+s+'<p class="limitstock-'+t.skuId+' p-name hide"></p><p class="understock-'+t.skuId+' hide"></p><input type="checkbox" name="skuIds" class="hide" value="'+t.skuId+'"></div></td>');return d},ec.cart.buildPrice=function(t){var e;return e=$(t.preferentialPrice?t.skuPrice==t.preferentialPrice?'<td class="tr-price"><span>&yen;'+t.skuPrice.toFixed(2)+"</span></td>":'<td class="tr-price"><s>原价:&yen;'+t.skuPrice.toFixed(2)+"</s><span>现价:&yen;"+t.preferentialPrice.toFixed(2)+"</span></td>":'<td class="tr-price"><s>原价:&yen;'+t.skuPrice.toFixed(2)+"</s><span>现价:&yen;0.00</span></td>")},ec.cart.buildQuantity=function(t,e,a,r){var c=$('<td class="tr-quantity" rowspan="'+r+'"><div class="sc-stock-area"><div class="stock-area"><input id="quantity-'+t+'" type="text" class="shop-quantity textbox vam" value="'+a+'" data-skuId="'+t+'" data-type="'+e+'" seed="cart-item-num"/></div><p class="normalLimitstock-'+t+' hide"></p></div></td>');return c},ec.cart.buildSubtotal=function(t,e,a,r){var c;if(t==e)c=$('<td rowspan="'+r+'" class="tr-subtotal"><b>&yen;'+t.toFixed(2)+"</b></td>");else{var i=(t-e)*a;c=$('<td rowspan="'+r+'" class="tr-subtotal"><b>&yen;'+e.toFixed(2)+"</b><span><i>省</i><em>&yen;"+i.toFixed(2)+"</em></span></td>")}return c},ec.cart.buildOperate=function(t){var e=$('<td rowspan="'+t+'" class="tr-operate"><a href="javascript:;" class="icon-sc-del" title="删除" seed="cart-item-del">删除</a></td>');return e},ec.cart.buildExtendSku=function(t,e,a,r){var c=$('<tr class="sc-pro-gift-item"></tr>'),i=ec.cart.buildSkuSummary(e,a,r);c.append(i);var s=ec.cart.buildPrice(e);c.append(s);var n=e.skuPrice*t,d=e.preferentialPrice*t,o=ec.cart.buildSubtotal(n,d,t,1);c.append(o);var l=ec.cart.buildOperate(1);return c.append(l),c},ec.cart.buildSubSku=function(t,e,a,r){var c=$('<tr class="'+e+'"></tr>'),i=ec.cart.buildSkuSummary(t,a,r);c.append(i);var s=ec.cart.buildPrice(t);return c.append(s),c},ec.cart.buildSku=function(t,e,a,r,c,i,s,n,d){var o=$('<tr class="sc-pro-item"></tr>'),l=ec.cart.buildCheckbox(t,i);o.append(l);var p=ec.cart.buildSkuSummary(c,n,d);o.append(p);var u=ec.cart.buildPrice(c);o.append(u);var h=ec.cart.buildQuantity(t,c.productType,e,i);o.append(h);var m=ec.cart.buildSubtotal(a,r,e,s);o.append(m);var v=ec.cart.buildOperate(s);return o.append(v),o},ec.cart.buildBundler=function(t,e,a,r){for(var c=t.skuList,i=c.length,s=0,n=0;n<c.length;++n){var d=c[n];d.giftList&&(s+=d.giftList.length)}i+=s;for(var o=ec.cart.buildItemTable(t.bundleId,e),n=0;n<c.length;++n){var l,d=c[n];l=0==n?ec.cart.buildSku(t.bundleId,t.quantity,t.totalBundlePrice,t.preferentialPrice,d,i,i,a,r):ec.cart.buildSubSku(d,"sc-pro-item",a,r),o.append(l)}if(s>0)for(var n=0;n<c.length;++n){var d=c[n],p=d.giftList;if(p)for(var u=0;u<p.length;++u){var h=p[u],l=ec.cart.buildSubSku(h,"sc-pro-gift-item",a,r);o.append(l)}}},ec.cart.buildProduct=function(t,e,a,r){var c=ec.cart.buildItemTable(t.skuId,e),i=t.giftList.length+t.extendList.length+1,s=t.giftList.length+1,n=t.skuPrice*t.quantity,d=t.preferentialPrice*t.quantity,o=ec.cart.buildSku(t.skuId,t.quantity,n,d,t,i,s,a,r);c.append(o);for(var l=t.giftList,p=0;p<l.length;++p){var u=l[p],o=ec.cart.buildSubSku(u,"sc-pro-gift-item",a,r);c.append(o)}for(var h=t.extendList,p=0;p<h.length;++p){var m=h[p],o=ec.cart.buildExtendSku(t.quantity,m,a,r);c.append(o)}},ec.cart.buildCoupon=function(t){var e=$('<tr><td class="tr-gift"><div class="gift-area"><dl><dt><b>'+t.name+"</b>有效期（"+t.beginDate+"至"+t.endDate+"）</dt><dd>商家活动："+t.promoCampaignName+'</dd></dl><s class="understock-'+t.premiumsSkuId+' hide"></s></div></td><td class="tr-quantity"><span><em>1</em>张</span></td><td>&nbsp;</td></tr>');return e},ec.cart.buildPremium=function(t){var e=$('<tr><td class="tr-gift"><div class="gift-area"><dl><dt>'+t.premiumsName+"</dt><dd>商家活动："+t.promoCampaignName+'</dd><dd class="understock-'+t.premiumsSkuId+' hide"></dd></dl></div></td><td class="tr-quantity"><span><em>1</em>个</span></td><td >&nbsp;</td></tr>');return e},ec.cart.buildCartGift=function(t,e){for(var a=$('<div class="hr-20"></div><div id="cart-gift-area" class="order-gift-list"><div class="h"><h3>赠品</h3></div><div class="b"><table border="0" cellpadding="0" cellspacing="0"><tbody id="cart-gift-list"></tbody></table></div></div>'),r=$("#cart-gift-list",a),c=0;c<t.length;++c){var i=t[c],s=ec.cart.buildCoupon(i);r.append(s)}for(var c=0;c<e.length;++c){var n=e[c],d=ec.cart.buildPremium(n);r.append(d)}return a},ec.cart.buildTotalArea=function(t){var e=$('<div class="hr-20"></div><div id="cart-total-area" class="sc-total-area clearfix"><div class="sc-total-control"><input id="checkAll-buttom" type="checkbox" name="" class="vam" autocomplete="off" checked /><label class="vam" for="checkAll-buttom">全选</label><a class="vam" href="javascript:;" seed="cart-all-del">删除选中商品</a></div><div class="sc-total-price"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><th>总计金额：</th><td id="sc-cartInfo-totalOriginalPrice">&yen;'+t.totalOriginalPrice.toFixed(2)+'</td></tr><tr><th>共节省：</th><td id="sc-cartInfo-minusPrice">&yen;'+(t.totalOriginalPrice-t.totalPrice).toFixed(2)+'</td></tr><tr><th><em>合计(不含运费)：<em></th><td><b id="sc-cartInfo-totalPrice">&yen;'+t.totalPrice.toFixed(2)+'<b></td></tr></tbody></table></div></div><div class="hr-25"></div><div class="sc-action-area clearfix"><a class="button-style-4 button-go-shopping-3" href="'+domainMain+'">继续购物</a><a class="button-style-1 button-go-checkout-2" href="javascript:;" seed="cart-pay">去结算</a><div class="sc-action-tips hide" id="sc-action-tips"><div class="tips-style-1 tips-area"><i></i><div class="tips-text"><p id="tips-text-p">购物车中有库存不足商品，请处理后结算</p></div><s></s></div></div></div>');return e},ec.cart.refreshCartTable=function(t,e){$("#cart-form").remove();var a=$("#cart-gift-area");a.prev().remove(),a.remove();var r=$("#cart-total-area");r.prev().remove(),r.next().next().remove().end().remove(),r.remove(),$("#cart-empty-msg").addClass("hide"),e?ec.cart.getCartInfo(t,ec.cart.initCartTable):($("#pro-recommend-area").hide(),ec.cart.getCartInfo(t,ec.cart.initCartTableAndRecommend))},ec.cart.initCartTable=function(t){var e=t.cartInfo;if(!e)return $("#cart-empty-msg").removeClass("hide"),!1;if((e.bundlerList&&0==e.bundlerList.length||!e.bundlerList)&&(e.productList&&0==e.productList.length||!e.productList))return $("#cart-empty-msg").removeClass("hide"),!1;ec.cart.convertDataStructure(t);var a=$('<span id="cart-list"></span>'),r=$('<form id="cart-form" autocomplete="off" method="get"></form>').submit(ec.shoppingCart.confirm).append('<input type="hidden" name="state" value="1"/>').append(a),c=$("#globleParameter"),i=domainMain+c.attr("context"),s=c.attr("mediaPath");e.context=i,e.mediaPath=s,a.html(ec.shoppingCart._template.parse("product-list",e));var n=ec.cart.buildTotalArea(e),d=$("div.sc-pro-list");d.append(r).after(n);var o=e.couponList,l=e.premiumsList;if(o&&o.length>0||l&&l.length>0){var p=ec.cart.buildCartGift(o,l);d.after(p)}return $("#checkAll-top").click(function(){$("#checkAll-buttom").attr("checked",this.checked),ec.shoppingCart.checkAll(this)}).attr("checked","checked"),$("#checkAll-buttom").click(function(){$("#checkAll-top").attr("checked",this.checked),ec.shoppingCart.checkAll(this)}),$(".sc-total-control a").click(function(){ec.shoppingCart.del(this)}),$(".sc-action-area a.button-go-checkout-2").click(ec.shoppingCart.confirm),ec.shoppingCart._renderNum(),ec.shoppingCart._renderColorAndVersion(),ec.shoppingCart._renderInventory(t.lowStockSkuIds,t.beyondLimitSkuIds),!0},ec.cart.initCartTableAndRecommend=function(t){ec.cart.initCartTable(t)&&ec.cart.initRecommend()},ec.cart.convertDataStructure=function(t){if(t.cartInfo.bundlerList)for(var e=0;e<t.cartInfo.bundlerList.length;e++)for(var a=t.cartInfo.bundlerList[e],r=0;r<a.skuList.length;r++){var c=a.skuList[r];c.preferentialPrice=c.skuPrice-c.discountPrice;for(var i=0;i<c.giftList.length;i++){var s=c.giftList[i];s.id=s.giftId,s.skuId=s.giftSkuId,s.prdSkuName=s.giftName}}if(t.cartInfo.productList)for(var e=0;e<t.cartInfo.productList.length;e++){var n=t.cartInfo.productList[e];n.preferentialPrice=n.skuPrice,n.skuPrice=n.ecshopPrice;for(var i=0;i<n.giftList.length;i++){var s=n.giftList[i];s.id=s.giftId,s.skuId=s.giftSkuId,s.prdSkuName=s.giftName}}t.lowStockSkuIds=t.understock,t.beyondLimitSkuIds=t.limitstock},ec.ready(function(){ec.shoppingCart._template=new ec.template($("#product-list-html").val()),ec.cart.getCart(ec.cart.initCartTableAndRecommend),ec.cart.refreshRecover()});